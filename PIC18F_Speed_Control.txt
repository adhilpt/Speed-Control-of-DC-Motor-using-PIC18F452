
;FOR CONTROLING SPEED OF A DC MOTOR BY PWM(PULSE-WIDTH MODULATION)
;skeleton of PIC18 Assembly language program
;Code by Adhil pt
LIST P=PIC18F452, F=INHX32, MM=OFF, N=0,ST=OFF, R=HEX
#include P18F452.INC
CONFIG OSC=HS, OSCS=OFF ;high-speed XTAL as clk src
CONFIG WDT=OFF ;disable watchdog timer
;Brown-out Reset Volt=4.5v and Power-up Timer is on
CONFIG BORV=45, PWRT=ON, BOR=OFF
;no Background debug, no Reset if stack overflows
;Code by Adhil pt
CONFIG DEBUG=OFF, LVP=OFF, STVR=OFF
ORG 0
BSF TRISB,7 ;SWITCH PORTB
BSF TRISB,1
BCF TRISA,3 ;OUTPUT PORTA
BCF PORTA,3
BCF TRISD,4 ;LED FOR 25%
BCF TRISD,5 ;LED FOR 50%
BCF TRISD,6 ;LED FOR 75%
BCF TRISD,7 ;LED FOR 100%
BCF PORTD,4
BCF PORTD,7
BCF PORTD,6
BCF PORTD,5
BCF PORTD,4
LOOP_INC BTFSS PORTB,7 ;CHECK INCREASE SWITCH IS PRESSED
GOTO DECR
GOTO DELAY25
DECR BTFSS PORTB,1 ;CHECK DECREASE SWITCH IS PRESSED
GOTO LOOP_INC
BRA OFF
DELAY25
XYZ1 BSF PORTA,3
BSF PORTD,4
CALL DELAY
BCF PORTA,3
CALL DELAY
CALL DELAY
CALL DELAY
BTFSS PORTB,7 ;CHECK INCREASE SWITCH IS PRESSED
GOTO CHECK1
BRA DELAY50
DELAY50
XYZ2 BSF PORTA,3
BCF PORTD,4
BSF PORTD,5
CALL DELAY
CALL DELAY
BCF PORTA,3
CALL DELAY
CALL DELAY
BTFSS PORTB,7 ;CHECK INCREASE SWITCH IS PRESSED
GOTO CHECK2
BRA DELAY75
DELAY75
XYZ3 BSF PORTA,3
BCF PORTD,5
BSF PORTD,6
CALL DELAY
CALL DELAY
CALL DELAY
BCF PORTA,3
CALL DELAY
BTFSS PORTB,7 ;CHECK INCREASE SWITCH IS PRESSED
GOTO CHECK3
BRA DELAY100
DELAY100
XYZ4 BSF PORTA,3
BCF PORTD,6
BSF PORTD,7
CALL DELAY
CALL DELAY
CALL DELAY
CALL DELAY
BCF PORTA,3
BCF PORTD,6
BTFSS PORTA,7 ;CHECK INCREASE SWITCH IS PRESSED
GOTO CHECK4
BRA DELAY100
CHECK1 BTFSS PORTB,1 ;CHECK DECREASE SWITCH IS PRESSED
GOTO XYZ1
BCF PORTD,4
GOTO OFF
CHECK2 BTFSS PORTB,1 ;CHECK DECREASE SWITCH IS PRESSED
GOTO XYZ2
BCF PORTD,5
BRA DELAY25
CHECK3 BTFSS PORTB,1 ;CHECK DECREASE SWITCH IS PRESSED
GOTO XYZ3
BCF PORTD,6
BRA DELAY50
CHECK4 BTFSS PORTB,1 ;CHECK DECREASE SWITCH IS PRESSED
GOTO XYZ4
BCF PORTD,7
BRA DELAY75
OFF BCF PORTA,3
ABC CALL DELAY
CALL DELAY
CALL DELAY
CALL DELAY
BTFSS PORTB,7 ;CHECK INCREASE SWITCH IS PRESSED
GOTO ABC
BRA DELAY25
DELAY
MOVLW 0x3 ;TIMER0,16-BIT, INT CLK, 256 PRESCALE
MOVWF T0CON ;LOAD TOCON REG.
HERE
MOVLW 0x8D ;TMROH = 8DH, THE HIGH BYTE
MOVWF TMR0H
MOVLW 0x90 ;TMROL = F2H, THE LOW BYTE
MOVWF TMR0L
BCF INTCON, TMR0IF ;CLEAR TIMER INTERRUPT FLAG BIT
BSF T0CON, TMR0ON ;START TIMERO
AGAIN BTFSS INTCON, TMR0IF
BRA AGAIN
BCF T0CON, TMR0ON
RETURN
END